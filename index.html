<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grand Auctioneer: Global Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --gold: #c5a059; --bg: #0a0a0a; }
        body { background: var(--bg); color: #fff; font-family: 'Times New Roman', serif; margin: 0; overflow: hidden; }
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; background: var(--bg); padding: 20px; }
        .active { display: flex; }
        .btn { background: var(--gold); border: none; padding: 15px; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; }
        .rank-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 0.9rem; }
        #item-img { max-height: 40vh; object-fit: contain; border-bottom: 2px solid var(--gold); }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active" style="align-items:center; justify-content:center;">
        <h1 style="color:var(--gold)">IDENTIFICACIÓN</h1>
        <input type="text" id="player-name" placeholder="Tu nombre de coleccionista" style="padding:10px; width:80%; text-align:center;">
        <button class="btn" onclick="login()">ENTRAR AL CLUB</button>
    </div>

    <div id="screen-menu" class="screen" style="align-items:center;">
        <h1 style="color:var(--gold)">GRAND AUCTIONEER</h1>
        <p>Saldo: <span id="ui-bal" style="color:var(--gold)">$25,000</span></p>
        <button class="btn" onclick="startAuction()">NUEVA SUBASTA (MET)</button>
        <button class="btn" style="background:#222; color:var(--gold)" onclick="showLeaderboard()">RANKING MUNDIAL</button>
    </div>

    <div id="screen-auction" class="screen">
        <img id="item-img" src="">
        <h2 id="item-title">---</h2>
        <div style="font-size: 2rem; color:var(--gold);">$<span id="ui-bid">0</span></div>
        <div id="ui-timer" style="font-size: 1.5rem; color:red;">10s</div>
        <button class="btn" onclick="makeBid()">OFERTAR +$1,000</button>
    </div>

    <div id="screen-rank" class="screen">
        <h2 style="color:var(--gold); text-align:center;">TOP 10 MUNDIAL</h2>
        <div id="rank-content" style="flex-grow:1;">Cargando...</div>
        <button class="btn" onclick="showScreen('screen-menu')">VOLVER</button>
    </div>

    <script>
        // --- PEGA TUS DATOS DE FIREBASE AQUÍ ---
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBKxFnl3QcmKNTm9b2vUZ7yd3mrcK4Mzm0",
  authDomain: "grandauctioneer.firebaseapp.com",
  projectId: "grandauctioneer",
  storageBucket: "grandauctioneer.firebasestorage.app",
  messagingSenderId: "779568791424",
  appId: "1:779568791424:web:c71c5fd48c541755ed0b65",
  measurementId: "G-H1FXFMF1NG"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let state = { name: "", balance: 25000, currentBid: 0, timer: 10, interval: null };

        function login() {
            state.name = document.getElementById('player-name').value || "Anónimo";
            showScreen('screen-menu');
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('ui-bal').innerText = state.balance.toLocaleString();
        }

        async function startAuction() {
            showScreen('screen-auction');
            document.getElementById('item-title').innerText = "Buscando en el museo...";
            
            try {
                // Lógica del MET Museum
                const r = await fetch('https://collectionapi.metmuseum.org/public/collection/v1/search?hasImages=true&q=gold');
                const d = await r.json();
                const objId = d.objectIDs[Math.floor(Math.random() * 50)];
                const or = await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${objId}`);
                const od = await or.json();

                document.getElementById('item-img').src = od.primaryImageSmall;
                document.getElementById('item-title').innerText = od.title;
                state.currentBid = Math.floor(Math.random() * 5000) + 1000;
                state.timer = 10;
                runAuction();
            } catch(e) { 
                alert("Error de conexión. Prueba de nuevo.");
                showScreen('screen-menu');
            }
        }

        function runAuction() {
            clearInterval(state.interval);
            state.interval = setInterval(() => {
                state.timer--;
                document.getElementById('ui-timer').innerText = state.timer + "s";
                document.getElementById('ui-bid').innerText = state.currentBid.toLocaleString();
                
                if(Math.random() > 0.8) state.currentBid += 1000;
                if(state.timer <= 0) {
                    clearInterval(state.interval);
                    finishAuction();
                }
            }, 1000);
        }

        function makeBid() {
            state.currentBid += 1000;
            state.timer = 6;
        }

        async function finishAuction() {
            alert("¡Subasta cerrada!");
            state.balance -= 1000; // Simulación de gasto/comisión
            await db.collection("leaderboard").doc(state.name).set({
                name: state.name,
                balance: state.balance
            }, { merge: true });
            showScreen('screen-menu');
        }

        async function showLeaderboard() {
            showScreen('screen-rank');
            const snap = await db.collection("leaderboard").orderBy("balance", "desc").limit(10).get();
            let html = "";
            snap.forEach(doc => {
                const p = doc.data();
                html += `<div class="rank-row"><span>${p.name}</span><span>$${p.balance.toLocaleString()}</span></div>`;
            });
            document.getElementById('rank-content').innerHTML = html;
        }
    </script>
</body>
</html>
