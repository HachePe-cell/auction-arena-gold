<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antique Auction Arena - Elite</title>
    <style>
        :root {
            --gold: #d4af37; --dark: #1a1410; --paper: #f4e4bc;
            --accent: #8b0000; --win: #2e7d32; --loss: #c62828;
        }
        body { 
            background-color: var(--dark); color: var(--paper); font-family: 'Georgia', serif;
            margin: 0; overflow: hidden; height: 100vh;
        }
        .screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle, #2c1e14 0%, #0a0a0a 100%); z-index: 10; padding: 20px; box-sizing: border-box;
        }
        .active { display: flex; }

        /* Setup Personalizaci√≥n */
        .setup-box { background: var(--paper); color: #333; padding: 30px; border-radius: 5px; border: 5px double var(--gold); text-align: center; width: 300px; }
        input { padding: 10px; width: 80%; margin: 10px 0; border: 1px solid #999; font-family: serif; }
        
        /* UI de Juego Estilo Antiguo */
        .profile-bar { position: absolute; top: 15px; left: 15px; display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 50px; border: 1px solid var(--gold); }
        .totem-icon { font-size: 1.5rem; filter: drop-shadow(0 0 5px var(--gold)); }

        .btn {
            padding: 12px 25px; border: 1px solid var(--gold); border-radius: 3px; font-weight: bold;
            cursor: pointer; transition: 0.3s; text-transform: uppercase; margin: 10px;
            background: var(--gold); color: var(--dark); box-shadow: 0 4px 0 #8b7500;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn-outline { background: transparent; color: var(--gold); }

        #game-board { 
            background: #2c1e14; padding: 20px; border: 2px solid var(--gold); width: 100%; max-width: 400px;
            box-shadow: 0 0 50px rgba(0,0,0,1); position: relative;
        }
        .item-frame { width: 100%; height: 220px; border: 8px inset #4a3728; margin-bottom: 15px; overflow: hidden; background: #000; }
        .item-frame img { width: 100%; height: 100%; object-fit: cover; sepia: 0.3; }

        .timer-wrap { width: 100%; height: 10px; background: #111; border: 1px solid var(--gold); margin: 15px 0; border-radius: 5px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--gold); transition: width 0.1s linear; }

        .market-card { background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 10px; border-radius: 4px; text-align: center; }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen active">
        <div class="setup-box">
            <h2 style="margin-top:0">REGISTRO DE POSTOR</h2>
            <input type="text" id="user-id" placeholder="Tu Nombre/ID..." maxlength="12">
            <p style="font-size: 0.8rem;">Selecciona tu T√≥tem de Suerte:</p>
            <div style="display:flex; justify-content:space-around; margin: 15px 0;">
                <button onclick="selectTotem('üçÄ', 'Suerte')" class="totem-btn" id="t1">üçÄ</button>
                <button onclick="selectTotem('ü¶Ö', 'Vista')" class="totem-btn" id="t2">ü¶Ö</button>
                <button onclick="selectTotem('ü™ô', 'Riqueza')" class="totem-btn" id="t3">ü™ô</button>
            </div>
            <button class="btn" onclick="startGame()">ENTRAR AL CLUB</button>
        </div>
    </div>

    <div id="main-menu" class="screen">
        <div class="profile-bar">
            <span id="display-totem" class="totem-icon">üçÄ</span>
            <span id="display-name" style="font-weight:bold; color:var(--gold);">ID</span>
        </div>
        <h1 style="color:var(--gold); font-size: 2.5rem; text-align:center;">GALER√çA DE<br>ANTIG√úEDADES</h1>
        <button class="btn" onclick="showScreen('game-screen')">BUSCAR SUBASTAS</button>
        <button class="btn btn-outline" onclick="showScreen('market-screen')">TASAR COLECCI√ìN</button>
        <div style="margin-top: 20px;">SALDO: <span style="color:var(--gold)">$</span><span class="balance-text">1000</span></div>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-board">
            <div class="item-frame"><img id="item-img" src=""></div>
            <div style="text-align: center;">
                <small id="rarity-text" style="color:var(--gold); font-style:italic;"></small>
                <h2 id="item-name" style="margin: 5px 0; color:var(--paper);">Cargando...</h2>
                <div style="font-size: 2rem; font-weight: bold; color:var(--gold);">$<span id="current-bid">0</span></div>
                <div id="winner-text" style="color: #999; font-size: 0.9rem;">Oferta actual: Nadie</div>
            </div>
            <div class="timer-wrap"><div id="timer-bar"></div></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn" style="margin:0; width:100%" onclick="playerBid()">OFERTAR +$50</button>
                <button class="btn btn-outline" style="margin:0; width:100%" onclick="showScreen('main-menu')">RETIRARSE</button>
            </div>
        </div>
    </div>

    <div id="market-screen" class="screen">
        <h2 style="color:var(--gold)">VALUACI√ìN DE ACTIVOS</h2>
        <div id="market-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; width:100%; max-width:400px; margin-bottom:20px;"></div>
        <button class="btn btn-outline" onclick="showScreen('main-menu')">VOLVER</button>
    </div>

    <div id="overlay" class="screen" style="background:rgba(0,0,0,0.9)">
        <h1 id="modal-title">¬°ADJUDICADO!</h1>
        <p id="modal-msg"></p>
        <button class="btn" onclick="closeModal()">CONTINUAR</button>
    </div>

    <script>
        let userData = JSON.parse(localStorage.getItem('auc_user')) || { name: "", totem: "üçÄ", totemType: "" };
        let balance = parseInt(localStorage.getItem('auc_bal')) || 1000;
        let inventory = JSON.parse(localStorage.getItem('auc_inv')) || [];
        let level = 1;

        let currentBid = 0, timeLeft = 15, timerInterval, lastBidder = "", bidCount = 0;

        const antiques = [
            { name: "Sable de Oficial (1812)", rarity: "COM√öN", base: 200, img: "https://images.unsplash.com/photo-1599751449128-eb7249c3d6b1?w=400" },
            { name: "Reloj Patek de Oro", rarity: "RARO", base: 800, img: "https://images.unsplash.com/photo-1509048191080-d2984bad6ad5?w=400" },
            { name: "Vasija Dinast√≠a Ming", rarity: "√âPICO", base: 2500, img: "https://images.unsplash.com/photo-1580536214401-02bb9bb123b6?w=400" },
            { name: "C√≥dice Medieval", rarity: "LEGENDARIO", base: 6000, img: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=400" }
        ];

        function selectTotem(icon, type) {
            userData.totem = icon; userData.totemType = type;
            document.querySelectorAll('.totem-btn').forEach(b => b.style.border = "none");
            event.target.style.border = "2px solid var(--gold)";
        }

        function startGame() {
            userData.name = document.getElementById('user-id').value || "Postor An√≥nimo";
            localStorage.setItem('auc_user', JSON.stringify(userData));
            document.getElementById('display-name').innerText = userData.name;
            document.getElementById('display-totem').innerText = userData.totem;
            showScreen('main-menu');
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            updateBalanceUI();
            if(id === 'game-screen') initAuction();
            if(id === 'market-screen') renderMarket();
        }

        function initAuction() {
            let item = antiques[Math.min(level-1, antiques.length-1)];
            currentBid = item.base;
            timeLeft = 15; lastBidder = "Nadie"; bidCount = 0;
            document.getElementById('item-name').innerText = item.name;
            document.getElementById('item-img').src = item.img;
            document.getElementById('rarity-text').innerText = item.rarity;
            document.getElementById('current-bid').innerText = currentBid;
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(!document.getElementById('game-screen').classList.contains('active')) return;
                timeLeft -= 0.1;
                document.getElementById('timer-bar').style.width = (timeLeft / 15 * 100) + "%";
                
                // Inteligencia Artificial m√°s lenta al principio
                let botThreshold = level < 3 ? 0.985 : 0.97;
                if (timeLeft > 1 && Math.random() > botThreshold && lastBidder !== "Bot") botBid();
                
                if (timeLeft <= 0) { clearInterval(timerInterval); endAuction(); }
            }, 100);
        }

        function playerBid() {
            if (balance >= currentBid + 50) {
                currentBid += 50; lastBidder = userData.name;
                timeLeft = Math.min(timeLeft + 2.5, 8); // Recupera tiempo
                updateUI();
            }
        }

        function botBid() {
            currentBid += 50; lastBidder = "Bot";
            timeLeft = Math.min(timeLeft + 2, 6);
            updateUI();
        }

        function updateUI() {
            document.getElementById('current-bid').innerText = currentBid;
            document.getElementById('winner-text').innerText = "L√≠der: " + (lastBidder === userData.name ? "T√∫" : "Competidor");
            updateBalanceUI();
        }

        function updateBalanceUI() {
            document.querySelectorAll('.balance-text').forEach(el => el.innerText = balance);
        }

        function renderMarket() {
            const grid = document.getElementById('market-grid');
            grid.innerHTML = inventory.length ? inventory.map((item, i) => `
                <div class="market-card">
                    <img src="${item.img}" style="width:100%; height:60px; object-fit:cover;">
                    <div style="font-size:0.7rem;">${item.name}</div>
                    <div style="color:var(--gold)">$${item.price}</div>
                    <button class="btn" style="padding:5px; font-size:0.6rem; width:100%;" onclick="sellItem(${i})">VENDER</button>
                </div>
            `).join('') : "<p style='grid-column:span 2'>Sin antig√ºedades.</p>";
        }

        function sellItem(i) {
            balance += inventory[i].price;
            inventory.splice(i, 1);
            save(); renderMarket(); updateBalanceUI();
        }

        function endAuction() {
            const overlay = document.getElementById('overlay');
            overlay.classList.add('active');
            let item = antiques[Math.min(level-1, antiques.length-1)];
            if (lastBidder === userData.name) {
                balance -= currentBid;
                inventory.push({name: item.name, img: item.img, price: Math.floor(currentBid * 1.2)});
                level++;
                document.getElementById('modal-title').innerText = "¬°ADJUDICADO!";
                document.getElementById('modal-msg').innerText = `Has ganado el ${item.name}. ¬°Una pieza magn√≠fica!`;
            } else {
                document.getElementById('modal-title').innerText = "¬°MARTILLAZO!";
                document.getElementById('modal-msg').innerText = "La pieza se ha vendido a otro coleccionista.";
            }
            save();
        }

        function save() {
            localStorage.setItem('auc_bal', balance);
            localStorage.setItem('auc_inv', JSON.stringify(inventory));
        }

        function closeModal() {
            document.getElementById('overlay').classList.remove('active');
            showScreen('main-menu');
        }

        // Cargar datos al inicio
        if(userData.name) {
            document.getElementById('setup-screen').classList.remove('active');
            document.getElementById('main-menu').classList.add('active');
            document.getElementById('display-name').innerText = userData.name;
            document.getElementById('display-totem').innerText = userData.totem;
        }
    </script>
</body>
</html>
