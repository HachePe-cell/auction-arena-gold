<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Cards | Multiplayer Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { 
            --gold: #d4af37; 
            --felt: #0a5c36; 
            --oro: #b8860b;
            --copa: #d32f2f;
            --espada: #1976d2;
            --basto: #388e3c;
        }
        
        body, html { margin: 0; padding: 0; height: 100%; background: #121212; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        .screen { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* Login y Lobby */
        .card-menu { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; width: 80%; max-width: 350px; }
        input { width: 100%; padding: 12px; margin: 15px 0; border-radius: 8px; border: none; box-sizing: border-box; font-size: 16px; }
        .btn-main { background: linear-gradient(135deg, var(--gold), #f7e0a1); color: #000; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }

        /* Mesa de Juego */
        #screen-game { background: radial-gradient(circle, var(--felt) 0%, #052c1a 100%); }
        
        .hand { display: flex; gap: 10px; position: absolute; bottom: 30px; z-index: 10; }
        
        /* ESTILO DE LAS CARTAS */
        .card { 
            width: 80px; height: 120px; background: white; border-radius: 10px; color: black;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; border: 3px solid #333; box-shadow: 0 6px 12px rgba(0,0,0,0.5);
            cursor: pointer; transition: transform 0.2s; position: relative;
        }
        .card:active { transform: scale(0.9); }
        
        .card .value { font-size: 1.8rem; line-height: 1; }
        .card .suit { font-size: 1.4rem; margin-top: 5px; }

        /* Colores din√°micos por palo */
        .card[data-palo="Oros"] { color: var(--oro); border-color: var(--oro); }
        .card[data-palo="Copas"] { color: var(--copa); border-color: var(--copa); }
        .card[data-palo="Espadas"] { color: var(--espada); border-color: var(--espada); }
        .card[data-palo="Bastos"] { color: var(--basto); border-color: var(--basto); }

        #played-area { 
            width: 90%; height: 180px; border: 2px dashed rgba(255,255,255,0.1); 
            border-radius: 20px; display: flex; justify-content: center; align-items: center; gap: 15px;
        }

        .status-msg { position: absolute; top: 80px; background: rgba(0,0,0,0.6); padding: 8px 20px; border-radius: 30px; font-size: 0.9rem; border: 1px solid var(--gold); }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active">
        <div class="card-menu">
            <h1 style="color:var(--gold); margin:0;">ELITE CARDS</h1>
            <p style="font-size: 0.8rem; opacity: 0.7;">PRO MULTIPLAYER</p>
            <input type="text" id="player-nick" placeholder="Tu Apodo">
            <button class="btn-main" onclick="entrar()">ENTRAR AL CLUB</button>
        </div>
    </div>

    <div id="screen-lobby" class="screen">
        <h2 style="color:var(--gold)">Mesas Disponibles</h2>
        <div id="rooms-container" style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 10px;"></div>
        <button class="btn-main" style="width:70%; margin-top:30px;" onclick="crearMesa()">+ CREAR MESA</button>
    </div>

    <div id="screen-game" class="screen">
        <div id="turn-indicator" class="status-msg">Esperando...</div>
        <div id="played-area"></div>
        <div class="hand" id="my-hand"></div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyBKxFnl3QcmKNTm9b2vUZ7yd3mrcK4Mzm0",
            authDomain: "grandauctioneer.firebaseapp.com",
            projectId: "grandauctioneer",
            databaseURL: "https://grandauctioneer-default-rtdb.firebaseio.com/", 
            storageBucket: "grandauctioneer.firebasestorage.app",
            appId: "1:779568791424:web:c71c5fd48c541755ed0b65"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let miNombre = "", miMano = [], mesaID = null, miRol = "";
        const ICONOS = { "Oros": "ü™ô", "Copas": "üèÜ", "Espadas": "‚öîÔ∏è", "Bastos": "ü™µ" };

        function entrar() {
            miNombre = document.getElementById('player-nick').value.trim();
            if(miNombre) {
                document.getElementById('screen-login').style.display = 'none';
                document.getElementById('screen-lobby').style.display = 'flex';
                escucharMesas();
            }
        }

        function crearMesa() {
            const id = "Mesa-" + Math.floor(Math.random()*9000);
            const mazo = barajar(generarMazo());
            db.ref('mesas/' + id).set({
                host: miNombre, invitado: "", mazo: mazo, turno: miNombre, estado: "esperando", cartasTiradas: []
            }).then(() => unirse(id));
        }

        function escucharMesas() {
            db.ref('mesas').on('value', snap => {
                const container = document.getElementById('rooms-container');
                container.innerHTML = "";
                const mesas = snap.val();
                if(mesas) {
                    Object.keys(mesas).forEach(id => {
                        if(mesas[id].estado === "esperando") {
                            container.innerHTML += `<div class="card-menu" style="padding:15px; width:80%; margin:0;"><p style="margin:5px">${mesas[id].host}</p><button class="btn-main" onclick="unirse('${id}')">UNIRSE</button></div>`;
                        }
                    });
                }
            });
        }

        function unirse(id) {
            mesaID = id;
            db.ref('mesas/'+id).once('value', snap => {
                const mesa = snap.val();
                miRol = (mesa.host === miNombre) ? "host" : "invitado";
                if(miRol === "invitado") db.ref('mesas/'+id).update({ invitado: miNombre, estado: "jugando" });
                document.getElementById('screen-lobby').style.display = 'none';
                document.getElementById('screen-game').style.display = 'flex';
                gestionarPartida();
            });
        }

        function gestionarPartida() {
            db.ref('mesas/' + mesaID).on('value', snap => {
                const mesa = snap.val();
                if(!mesa) return;

                if(mesa.estado === "jugando" && miMano.length === 0) {
                    miMano = (miRol === "host") ? [mesa.mazo[0], mesa.mazo[2], mesa.mazo[4]] : [mesa.mazo[1], mesa.mazo[3], mesa.mazo[5]];
                    renderHand();
                }

                const tInd = document.getElementById('turn-indicator');
                tInd.innerText = (mesa.turno === miNombre) ? "TU TURNO" : "TURNO DE: " + mesa.turno;
                tInd.style.border = (mesa.turno === miNombre) ? "2px solid var(--gold)" : "1px solid #666";

                renderTable(mesa.cartasTiradas || []);
            });
        }

        function renderHand() {
            const container = document.getElementById('my-hand');
            container.innerHTML = "";
            miMano.forEach((c, i) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.setAttribute('data-palo', c.palo);
                cardDiv.innerHTML = `<div class="value">${c.valor}</div><div class="suit">${ICONOS[c.palo]}</div>`;
                cardDiv.onclick = () => tirarCarta(i);
                container.appendChild(cardDiv);
            });
        }

        function tirarCarta(index) {
            db.ref('mesas/' + mesaID).once('value', snap => {
                const mesa = snap.val();
                if(mesa.turno !== miNombre) return;

                const carta = miMano.splice(index, 1)[0];
                const tiradas = mesa.cartasTiradas || [];
                tiradas.push({ jugador: miNombre, carta: carta });

                const siguienteTurno = (miRol === "host") ? (mesa.invitado || miNombre) : mesa.host;

                db.ref('mesas/' + mesaID).update({ cartasTiradas: tiradas, turno: siguienteTurno });
                renderHand();
            });
        }

        function renderTable(tiradas) {
            const area = document.getElementById('played-area');
            area.innerHTML = "";
            tiradas.forEach(t => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.setAttribute('data-palo', t.carta.palo);
                cardDiv.style.cursor = "default";
                cardDiv.innerHTML = `<div class="value">${t.carta.valor}</div><div class="suit">${ICONOS[t.carta.palo]}</div><small style="font-size:10px">${t.jugador}</small>`;
                area.appendChild(cardDiv);
            });
        }

        function generarMazo() {
            const palos = ["Oros", "Copas", "Espadas", "Bastos"];
            const mazo = [];
            palos.forEach(p => [1,2,3,4,5,6,7,10,11,12].forEach(v => mazo.push({valor:v, palo:p})));
            return mazo;
        }

        function barajar(m) { return m.sort(() => Math.random() - 0.5); }
    </script>
</body>
</html>
