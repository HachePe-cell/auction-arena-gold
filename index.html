<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Cards | IA & Battle Mode</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #d4af37; --felt: #0a5c36; --oro: #b8860b; --copa: #d32f2f; --espada: #1976d2; --basto: #388e3c; }
        body, html { margin: 0; padding: 0; height: 100%; background: #121212; color: white; font-family: sans-serif; overflow: hidden; }
        .screen { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* Estilo MenÃº */
        .card-menu { background: rgba(255,255,255,0.05); padding: 25px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; width: 85%; max-width: 350px; }
        .btn-main { background: linear-gradient(135deg, var(--gold), #f7e0a1); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; margin-bottom: 8px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #eee; }

        /* Mesa y Juego */
        #screen-game { background: radial-gradient(circle, var(--felt) 0%, #052c1a 100%); }
        .scoreboard { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 1px solid var(--gold); font-size: 0.8rem; z-index: 50; }
        
        .hand { display: flex; gap: 8px; position: absolute; bottom: 25px; }
        .card { 
            width: 70px; height: 105px; background: white; border-radius: 8px; color: black;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; border: 3px solid #333; cursor: pointer; transition: 0.2s;
        }
        .card[data-palo="Oros"] { color: var(--oro); border-color: var(--oro); }
        .card[data-palo="Copas"] { color: var(--copa); border-color: var(--copa); }
        .card[data-palo="Espadas"] { color: var(--espada); border-color: var(--espada); }
        .card[data-palo="Bastos"] { color: var(--basto); border-color: var(--basto); }

        #played-area { width: 100%; height: 140px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .msg { position: absolute; top: 85px; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: var(--gold); }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active">
        <div class="card-menu">
            <h1 style="color:var(--gold); margin:0;">ELITE CARDS</h1>
            <input type="text" id="player-nick" placeholder="Tu Apodo">
            
            <p style="margin-bottom:5px;">Dificultad de la IA:</p>
            <select id="bot-difficulty">
                <option value="easy">FÃ¡cil (Azar)</option>
                <option value="medium">Media (Estratega)</option>
                <option value="hard">DifÃ­cil (Maestro)</option>
            </select>

            <button class="btn-main" onclick="entrar(false)">Jugar contra BOT ðŸ¤–</button>
            <button class="btn-main" style="background:#444; color:white;" onclick="entrar(true)">Multijugador ðŸ‘¥</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="scoreboard">
            TÃš: <span id="score-mine">0</span><br>
            RIVAL: <span id="score-theirs">0</span><br>
            META: 15 PTS
        </div>
        <div id="turn-indicator" class="msg">Tu turno</div>
        <div id="played-area"></div>
        <div class="hand" id="my-hand"></div>
    </div>

    <script>
        // CONFIG FIREBASE (MantÃ©n la tuya)
        const firebaseConfig = { 
            apiKey: "AIzaSyBKxFnl3QcmKNTm9b2vUZ7yd3mrcK4Mzm0",
            authDomain: "grandauctioneer.firebaseapp.com",
            projectId: "grandauctioneer",
            databaseURL: "https://grandauctioneer-default-rtdb.firebaseio.com/", 
            storageBucket: "grandauctioneer.firebasestorage.app",
            appId: "1:779568791424:web:c71c5fd48c541755ed0b65"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let miNombre = "", miMano = [], manoBot = [], mesaID = null;
        let esMultijugador = false, miRol = "host", dificultad = "easy";
        const ICONOS = { "Oros": "ðŸª™", "Copas": "ðŸ†", "Espadas": "âš”ï¸", "Bastos": "ðŸªµ" };
        const PUNTAJE_MAXIMO = 15;

        function obtenerPoder(v, p) {
            if (v === 1 && p === "Espadas") return 14;
            if (v === 1 && p === "Bastos") return 13;
            if (v === 7 && p === "Espadas") return 12;
            if (v === 7 && p === "Oros") return 11;
            if (v === 3) return 10; if (v === 2) return 9; if (v === 1) return 8;
            return v;
        }

        function entrar(multi) {
            miNombre = document.getElementById('player-nick').value || "Jugador";
            dificultad = document.getElementById('bot-difficulty').value;
            esMultijugador = multi;
            
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('screen-game').style.display = 'flex';

            if(!esMultijugador) iniciarModoBot();
        }

        // --- LÃ“GICA DEL BOT ---
        function iniciarModoBot() {
            const mazo = generarMazo().sort(() => Math.random() - 0.5);
            miMano = [mazo[0], mazo[2], mazo[4]];
            manoBot = [mazo[1], mazo[3], mazo[5]];
            
            const mesaSimulada = {
                host: miNombre, invitado: "Bot ðŸ¤–", turno: miNombre,
                puntosHost: 0, puntosInvitado: 0, cartasTiradas: []
            };
            
            actualizarInterfazBot(mesaSimulada);
        }

        function actualizarInterfazBot(mesa) {
            if(mesa.puntosHost >= PUNTAJE_MAXIMO || mesa.puntosInvitado >= PUNTAJE_MAXIMO) {
                alert("FIN DEL JUEGO. Ganador: " + (mesa.puntosHost >= PUNTAJE_MAXIMO ? miNombre : "Bot"));
                location.reload(); return;
            }

            document.getElementById('score-mine').innerText = mesa.puntosHost;
            document.getElementById('score-theirs').innerText = mesa.puntosInvitado;
            document.getElementById('turn-indicator').innerText = mesa.turno === miNombre ? "TU TURNO" : "Bot pensando...";
            
            renderHand();
            renderTable(mesa.cartasTiradas);

            if(mesa.turno !== miNombre) {
                setTimeout(() => botJuega(mesa), 1500);
            }
        }

        function botJuega(mesa) {
            let index = 0;
            // Dificultad Selectiva
            if(dificultad === "easy") {
                index = Math.floor(Math.random() * manoBot.length);
            } else {
                // Media/Dura: Busca su carta con mÃ¡s poder
                manoBot.sort((a,b) => obtenerPoder(b.valor, b.palo) - obtenerPoder(a.valor, a.palo));
                index = (dificultad === "hard") ? 0 : Math.floor(manoBot.length / 2);
            }

            const carta = manoBot.splice(index, 1)[0];
            mesa.cartasTiradas.push({ jugador: "Bot ðŸ¤–", carta: carta });
            mesa.turno = miNombre;

            evaluarRondaLocal(mesa);
        }

        function evaluarRondaLocal(mesa) {
            if(mesa.cartasTiradas.length === 2) {
                renderTable(mesa.cartasTiradas);
                setTimeout(() => {
                    const p1 = obtenerPoder(mesa.cartasTiradas[0].carta.valor, mesa.cartasTiradas[0].carta.palo);
                    const p2 = obtenerPoder(mesa.cartasTiradas[1].carta.valor, mesa.cartasTiradas[1].carta.palo);
                    
                    const ganador = (p1 >= p2) ? mesa.cartasTiradas[0].jugador : mesa.cartasTiradas[1].jugador;
                    if(ganador === miNombre) mesa.puntosHost++; else mesa.puntosInvitado++;
                    
                    mesa.cartasTiradas = [];
                    mesa.turno = ganador;

                    if(miMano.length === 0 && manoBot.length === 0) {
                        const mazo = generarMazo().sort(() => Math.random() - 0.5);
                        miMano = [mazo[0], mazo[2], mazo[4]];
                        manoBot = [mazo[1], mazo[3], mazo[5]];
                    }
                    actualizarInterfazBot(mesa);
                }, 1500);
            } else {
                actualizarInterfazBot(mesa);
            }
        }

        // --- FUNCIONES DE RENDER --- (Compartidas)
        function renderHand() {
            const container = document.getElementById('my-hand');
            container.innerHTML = "";
            miMano.forEach((c, i) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.setAttribute('data-palo', c.palo);
                cardDiv.innerHTML = `<div>${c.valor}</div><div>${ICONOS[c.palo]}</div>`;
                cardDiv.onclick = () => {
                    // Si es turno del jugador
                    miMano.splice(i, 1);
                    // AquÃ­ irÃ­a la lÃ³gica de tirar para el bot o multijugador
                    // Por brevedad, simulamos la tirada en modo BOT:
                    const mesaSim = {
                        host: miNombre, invitado: "Bot ðŸ¤–", turno: "Bot ðŸ¤–",
                        puntosHost: parseInt(document.getElementById('score-mine').innerText),
                        puntosInvitado: parseInt(document.getElementById('score-theirs').innerText),
                        cartasTiradas: [{jugador: miNombre, carta: c}]
                    };
                    evaluarRondaLocal(mesaSim);
                };
                container.appendChild(cardDiv);
            });
        }

        function renderTable(tiradas) {
            const area = document.getElementById('played-area');
            area.innerHTML = "";
            tiradas.forEach(t => {
                area.innerHTML += `<div class="card" data-palo="${t.carta.palo}" style="cursor:default"><div>${t.carta.valor}</div><div>${ICONOS[t.carta.palo]}</div></div>`;
            });
        }

        function generarMazo() {
            const m = [];
            ["Oros", "Copas", "Espadas", "Bastos"].forEach(p => [1,2,3,4,5,6,7,10,11,12].forEach(v => m.push({valor:v, palo:p})));
            return m;
        }
    </script>
</body>
</html>
