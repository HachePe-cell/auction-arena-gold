<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction Arena | Gold Audio Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

    <style>
        :root { 
            --gold-gradient: linear-gradient(135deg, #c5a059 0%, #f7e0a1 50%, #c5a059 100%);
            --dark-bg: #050505;
            --card-bg: rgba(255, 255, 255, 0.05);
            --gold: #c5a059;
            --green: #44ff44;
            --red: #ff4444;
        }

        body { 
            background: var(--dark-bg); color: #fff; font-family: 'Segoe UI', sans-serif; 
            margin: 0; overflow: hidden;
            background-image: radial-gradient(circle at top right, #1a1a1a, #050505);
        }
        
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; padding: 25px; box-sizing: border-box; animation: fadeIn 0.4s ease-out; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .header-title h1 { font-family: 'Georgia', serif; font-size: 2rem; background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; text-align: center; margin: 0; }
        .glass-card { background: var(--card-bg); border: 1px solid rgba(197, 160, 89, 0.2); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }

        .btn-main { background: var(--gold-gradient); color: #000; border: none; padding: 18px; border-radius: 12px; font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px rgba(197, 160, 89, 0.2); width: 100%; }
        .btn-secondary { background: rgba(255,255,255,0.03); color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; }

        .museum-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; overflow-y: auto; padding-bottom: 80px; }
        .art-card { background: #111; border-radius: 12px; overflow: hidden; border: 1px solid #222; position: relative; }
        .art-card img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .art-card .price-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); color: var(--gold); font-size: 0.7rem; text-align: center; padding: 5px 0; }

        #sale-panel { position: fixed; bottom: -100%; left: 0; width: 100%; background: #0a0a0a; border-top: 3px solid var(--gold); padding: 30px 25px; box-sizing: border-box; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 100; border-radius: 30px 30px 0 0; }
        .panel-open { bottom: 0 !important; }

        #img-container { height: 30vh; background: #000; border-radius: 15px; display: flex; align-items: center; justify-content: center; position: relative; border: 1px solid #333; }
        #item-img { max-height: 100%; max-width: 100%; opacity: 0; transition: 0.4s; }
        .loader { position: absolute; border: 3px solid #111; border-top: 3px solid var(--gold); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active" style="justify-content: center;">
        <div class="header-title"><h1>AUCTION ARENA</h1><p style="text-align:center; color:#666">PRO COLLECTOR</p></div>
        <input type="text" id="player-name" placeholder="NOMBRE DEL POSTOR" style="background:rgba(255,255,255,0.05); border:1px solid #333; padding:18px; border-radius:12px; color:#fff; text-align:center; margin: 20px 0;">
        <button class="btn-main" onclick="login()">INGRESAR AL CLUB</button>
    </div>

    <div id="screen-menu" class="screen">
        <div class="header-title"><h1>ESTUDIO</h1></div>
        <div class="glass-card" style="text-align: center; margin-bottom: 20px;">
            <small style="color:var(--gold)">CAPITAL DISPONIBLE</small>
            <div id="ui-bal" style="font-size: 2.5rem; font-weight: 800;">$25,000</div>
        </div>
        <button class="btn-main" onclick="startAuction()" style="margin-bottom: 15px;">NUEVA SUBASTA</button>
        <button class="btn-secondary" onclick="showCollection()">BÓVEDA DE ARTE (<span id="col-count">0</span>)</button>
    </div>

    <div id="screen-auction" class="screen">
        <div id="img-container"><div class="loader" id="auction-loader"></div><img id="item-img" src=""></div>
        <h2 id="item-title" style="font-size: 1rem; color: var(--gold); margin: 15px 0;">Cargando...</h2>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <div><small style="color:#666">OFERTA</small><div id="ui-bid" style="font-size:1.8rem; font-weight:800;">$0</div></div>
            <div id="ui-timer" style="font-size:2.5rem; font-weight:900; color:var(--red);">--</div>
        </div>
        <div id="bid-status" style="text-align:center; margin-bottom:15px; font-size:0.9rem; color:var(--gold)">---</div>
        <button class="btn-main" onclick="makeBid()">PUJAR +$1,000</button>
    </div>

    <div id="screen-collection" class="screen">
        <div class="header-title"><h1>MI BÓVEDA</h1></div>
        <div id="gallery-content" class="museum-grid"></div>
        <button class="btn-secondary" onclick="showScreen('screen-menu')" style="position:fixed; bottom:20px; width:calc(100% - 50px)">VOLVER</button>
    </div>

    <div id="sale-panel">
        <div style="text-align: center;">
            <h2 style="color:var(--gold)">VALUACIÓN</h2>
            <div id="sale-offer" style="font-size: 2.5rem; font-weight: 800; margin: 20px 0; color: var(--green);">$0</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <button class="btn-main" id="confirm-sale-btn">VENDER</button>
                <button class="btn-secondary" onclick="closeSalePanel()">CONSERVAR</button>
            </div>
        </div>
    </div>

    <script>
        // MOTOR DE SONIDO (Sintetizador Web Audio)
        const AudioEngine = {
            ctx: null,
            init() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play(type) {
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain); gain.connect(this.ctx.destination);

                if(type === 'bid') { // Sonido corto de puja
                    osc.frequency.setValueAtTime(600, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
                    osc.start(); osc.stop(this.ctx.currentTime + 0.1);
                }
                if(type === 'tick') { // Tick de reloj
                    osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                    gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.05);
                    osc.start(); osc.stop(this.ctx.currentTime + 0.05);
                }
                if(type === 'win') { // Victoria
                    osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.5);
                    osc.start(); osc.stop(this.ctx.currentTime + 0.5);
                }
                if(type === 'cash') { // Caja registradora
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(1000, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1500, this.ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                    osc.start(); osc.stop(this.ctx.currentTime + 0.3);
                }
                if(type === 'fail') { // Perder
                    osc.frequency.setValueAtTime(200, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.4);
                    osc.start(); osc.stop(this.ctx.currentTime + 0.4);
                }
            }
        };

        // FIREBASE & LOGIC
        const firebaseConfig = { apiKey: "AIzaSyBKxFnl3QcmKNTm9b2vUZ7yd3mrcK4Mzm0", authDomain: "grandauctioneer.firebaseapp.com", projectId: "grandauctioneer", storageBucket: "grandauctioneer.firebasestorage.app", messagingSenderId: "779568791424", appId: "1:779568791424:web:c71c5fd48c541755ed0b65" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const RIVALES = ["Magnate Suizo", "Barón von Art", "Jeque Dubái", "Inversor NY"];
        let state = { name: "", balance: 25000, currentBid: 0, timer: 12, interval: null, leader: "", collection: JSON.parse(localStorage.getItem('myCollection')) || [] };

        function login() { state.name = document.getElementById('player-name').value || "Postor"; AudioEngine.init(); showScreen('screen-menu'); }
        function updateUI() { document.getElementById('ui-bal').innerText = "$" + state.balance.toLocaleString(); document.getElementById('col-count').innerText = state.collection.length; }
        function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); updateUI(); }

        async function startAuction() {
            showScreen('screen-auction');
            const title = document.getElementById('item-title');
            const img = document.getElementById('item-img');
            const loader = document.getElementById('auction-loader');
            clearInterval(state.interval);
            document.getElementById('ui-timer').innerText = "--";
            img.style.opacity = "0"; loader.style.display = "block";
            title.innerText = "Localizando obra...";

            let finalImg = `https://picsum.photos/seed/${Math.random()}/400/300`;
            try {
                const r = await fetch('https://collectionapi.metmuseum.org/public/collection/v1/search?hasImages=true&q=gold');
                const d = await r.json();
                const obj = await (await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${d.objectIDs[Math.floor(Math.random()*100)]}`)).json();
                if(obj.primaryImageSmall) { finalImg = obj.primaryImageSmall; title.innerText = obj.title; }
            } catch(e) {}

            const tImg = new Image(); tImg.src = finalImg;
            tImg.onload = () => {
                img.src = finalImg; img.style.opacity = "1"; loader.style.display = "none";
                state.currentArtImg = finalImg; iniciarReloj();
            };
        }

        function iniciarReloj() {
            state.currentBid = Math.floor(Math.random() * 5000) + 5000;
            state.leader = RIVALES[Math.floor(Math.random()*RIVALES.length)];
            state.timer = 12;
            state.interval = setInterval(() => {
                state.timer--;
                document.getElementById('ui-timer').innerText = state.timer;
                document.getElementById('ui-bid').innerText = "$" + state.currentBid.toLocaleString();
                document.getElementById('bid-status').innerText = "LÍDER: " + state.leader;
                
                if(state.timer <= 3 && state.timer > 0) AudioEngine.play('tick');

                if(state.timer > 1 && Math.random() > 0.8 && state.leader === state.name) {
                    state.currentBid += 1000; state.leader = RIVALES[Math.floor(Math.random()*RIVALES.length)];
                    AudioEngine.play('bid');
                }
                if(state.timer <= 0) { clearInterval(state.interval); terminar(); }
            }, 1000);
        }

        function makeBid() { if(state.balance >= state.currentBid + 1000){ state.currentBid += 1000; state.leader = state.name; AudioEngine.play('bid'); } }

        function terminar() {
            if(state.leader === state.name) {
                AudioEngine.play('win');
                alert("¡PIEZA GANADA!");
                state.balance -= state.currentBid;
                state.collection.push({ img: state.currentArtImg, cost: state.currentBid });
                localStorage.setItem('myCollection', JSON.stringify(state.collection));
            } else {
                AudioEngine.play('fail');
                alert("PERDISTE LA SUBASTA");
            }
            sync(); showScreen('screen-menu');
        }

        function showCollection() {
            showScreen('screen-collection');
            document.getElementById('gallery-content').innerHTML = state.collection.map((art, i) => `
                <div class="art-card" onclick="openSale(${i})"><img src="${art.img}"><div class="price-tag">$${art.cost.toLocaleString()}</div></div>
            `).join('');
        }

        function openSale(i) {
            state.sel = i;
            const offer = Math.floor(state.collection[i].cost * (0.8 + Math.random()));
            document.getElementById('sale-offer').innerText = "$" + offer.toLocaleString();
            document.getElementById('confirm-sale-btn').onclick = () => {
                AudioEngine.play('cash');
                state.balance += offer;
                state.collection.splice(i, 1);
                localStorage.setItem('myCollection', JSON.stringify(state.collection));
                closeSalePanel(); sync(); showCollection();
            };
            document.getElementById('sale-panel').classList.add('panel-open');
        }

        function closeSalePanel() { document.getElementById('sale-panel').classList.remove('panel-open'); }
        async function sync() { updateUI(); try { await db.collection("leaderboard").doc(state.name).set({ name: state.name, balance: state.balance }, { merge: true }); } catch(e) {} }
    </script>
</body>
</html>
