<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Cards | Global Ranking</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #d4af37; --felt: #0a5c36; --dark: #0a0a0a; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* FONDO ANIMADO */
        .bg-animation { position: fixed; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle, #1a1a1a, #000); overflow: hidden; }
        .floating-card { position: absolute; opacity: 0.1; font-size: 50px; animation: float 15s linear infinite; bottom: -100px; }
        @keyframes float { 
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(-110vh) rotate(360deg); }
        }

        .screen { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .active { display: flex; }

        /* Interfaz */
        .card-menu { background: rgba(0,0,0,0.8); padding: 30px; border-radius: 20px; border: 2px solid var(--gold); text-align: center; width: 85%; max-width: 350px; box-shadow: 0 0 20px var(--gold); }
        .btn-main { background: linear-gradient(to bottom, var(--gold), #b8860b); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.3s; }
        .btn-main:hover { transform: scale(1.05); filter: brightness(1.2); }
        input { width: 90%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid var(--gold); background: #222; color: white; text-align: center; }

        /* Juego */
        #screen-game { background: radial-gradient(circle, var(--felt) 0%, #052c1a 100%); }
        .scoreboard { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 1px solid var(--gold); font-size: 0.8rem; line-height: 1.4; }
        
        .card { 
            width: 75px; height: 110px; background: white; border-radius: 8px; color: black;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; border: 3px solid #333; cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
        }
        .card:hover { transform: translateY(-15px); z-index: 100; }
        .in-table { animation: deal 0.5s ease-out forwards; }
        @keyframes deal { from { transform: translateY(200px) scale(0); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        /* Colores Palos */
        .card[data-palo="Oros"] { color: #b8860b; border-color: #b8860b; }
        .card[data-palo="Copas"] { color: #d32f2f; border-color: #d32f2f; }
        .card[data-palo="Espadas"] { color: #1976d2; border-color: #1976d2; }
        .card[data-palo="Bastos"] { color: #388e3c; border-color: #388e3c; }

        .hand { display: flex; gap: 10px; position: absolute; bottom: 30px; }
    </style>
</head>
<body>

    <div class="bg-animation" id="bg-anim"></div>

    <div id="screen-login" class="screen active">
        <div class="card-menu">
            <h1 style="color:var(--gold); margin:0 0 10px 0;">ELITE CARDS</h1>
            <input type="text" id="player-nick" placeholder="Usuario">
            <input type="password" id="player-pin" placeholder="PIN (4 d√≠gitos)" maxlength="4">
            <p id="user-status" style="font-size: 10px; color: var(--gold);"></p>
            <button class="btn-main" onclick="autenticar()">INGRESAR / REGISTRAR</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="scoreboard">
            <b id="display-name">---</b><br>
            PUNTOS GLOBAL: <span id="global-pts">0</span><br><hr>
            ESTA PARTIDA:<br>
            T√ö: <span id="score-mine">0</span> | RIVAL: <span id="score-theirs">0</span>
        </div>
        <div id="played-area" style="display: flex; gap: 15px; height: 150px;"></div>
        <div class="hand" id="my-hand"></div>
    </div>

    <script>
        // CONFIG FIREBASE (Sigue usando la tuya)
        const firebaseConfig = { 
            apiKey: "AIzaSyBKxFnl3QcmKNTm9b2vUZ7yd3mrcK4Mzm0",
            authDomain: "grandauctioneer.firebaseapp.com",
            projectId: "grandauctioneer",
            databaseURL: "https://grandauctioneer-default-rtdb.firebaseio.com/", 
            appId: "1:779568791424:web:c71c5fd48c541755ed0b65"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let userData = { nick: "", pin: "", pts: 0 };
        let miMano = [], manoBot = [], mesaLocal = null;
        const ICONOS = { "Oros": "ü™ô", "Copas": "üèÜ", "Espadas": "‚öîÔ∏è", "Bastos": "ü™µ" };

        // --- FONDO ANIMADO ---
        function createBg() {
            const anim = document.getElementById('bg-anim');
            const icons = ['‚ô†','‚ô£','‚ô•','‚ô¶'];
            for(let i=0; i<15; i++) {
                let div = document.createElement('div');
                div.className = 'floating-card';
                div.innerText = icons[Math.floor(Math.random()*4)];
                div.style.left = Math.random() * 100 + 'vw';
                div.style.animationDelay = Math.random() * 15 + 's';
                anim.appendChild(div);
            }
        }
        createBg();

        // --- SISTEMA DE USUARIOS ---
        async function autenticar() {
            const nick = document.getElementById('player-nick').value.trim().toLowerCase();
            const pin = document.getElementById('player-pin').value;

            if(nick.length < 3 || pin.length < 4) return alert("Completa los datos");

            const snap = await db.ref('usuarios/' + nick).once('value');
            const data = snap.val();

            if(data) {
                if(data.pin === pin) {
                    userData = data;
                    iniciarJuego();
                } else {
                    alert("PIN INCORRECTO");
                }
            } else {
                // Registro nuevo
                userData = { nick: nick, pin: pin, pts: 0 };
                await db.ref('usuarios/' + nick).set(userData);
                iniciarJuego();
            }
        }

        // --- L√ìGICA DE JUEGO ---
        function iniciarJuego() {
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('screen-game').style.display = 'flex';
            document.getElementById('display-name').innerText = userData.nick.toUpperCase();
            document.getElementById('global-pts').innerText = userData.pts;
            
            // Iniciar modo BOT por defecto para este ejemplo
            const m = generarMazo();
            miMano = [m[0], m[2], m[4]];
            manoBot = [m[1], m[3], m[5]];
            mesaLocal = { turno: userData.nick, ptsJ: 0, ptsB: 0, tiradas: [] };
            render();
        }

        function generarMazo() {
            const p = ["Oros", "Copas", "Espadas", "Bastos"];
            const v = [1,2,3,4,5,6,7,10,11,12];
            let deck = [];
            p.forEach(palo => v.forEach(val => deck.push({valor: val, palo: palo})));
            return deck.sort(() => Math.random() - 0.5);
        }

        function tirarCarta(i) {
            if(mesaLocal.turno !== userData.nick || mesaLocal.tiradas.length >= 2) return;
            
            const c = miMano.splice(i, 1)[0];
            mesaLocal.tiradas.push({ j: userData.nick, carta: c });
            mesaLocal.turno = "Bot";
            render();
            setTimeout(botTurno, 1000);
        }

        function botTurno() {
            const c = manoBot.splice(0, 1)[0];
            mesaLocal.tiradas.push({ j: "Bot", carta: c });
            render();
            setTimeout(evaluar, 1000);
        }

        function evaluar() {
            const p1 = mesaLocal.tiradas[0].carta.valor; // Simplificado para el ejemplo
            const p2 = mesaLocal.tiradas[1].carta.valor;
            const win = p1 >= p2 ? mesaLocal.tiradas[0].j : mesaLocal.tiradas[1].j;

            if(win === userData.nick) mesaLocal.ptsJ++; else mesaLocal.ptsB++;
            
            mesaLocal.tiradas = [];
            mesaLocal.turno = win;

            if(miMano.length === 0) {
                const m = generarMazo();
                miMano = [m[0], m[2], m[4]];
                manoBot = [m[1], m[3], m[5]];
            }

            if(mesaLocal.ptsJ >= 15) {
                alert("¬°GANASTE! +10 puntos globales");
                actualizarPuntosGlobales(10);
                location.reload();
            } else if(mesaLocal.ptsB >= 15) {
                alert("Perdiste...");
                location.reload();
            }
            render();
            if(mesaLocal.turno === "Bot") setTimeout(botTurno, 1000);
        }

        async function actualizarPuntosGlobales(p) {
            userData.pts += p;
            await db.ref('usuarios/' + userData.nick).update({ pts: userData.pts });
        }

        function render() {
            document.getElementById('score-mine').innerText = mesaLocal.ptsJ;
            document.getElementById('score-theirs').innerText = mesaLocal.ptsB;

            const h = document.getElementById('my-hand');
            h.innerHTML = "";
            miMano.forEach((c, i) => {
                const d = document.createElement('div');
                d.className = 'card';
                d.setAttribute('data-palo', c.palo);
                d.innerHTML = `${c.valor}<br>${ICONOS[c.palo]}`;
                d.onclick = () => tirarCarta(i);
                h.appendChild(d);
            });

            const a = document.getElementById('played-area');
            a.innerHTML = "";
            mesaLocal.tiradas.forEach(t => {
                const d = document.createElement('div');
                d.className = 'card in-table';
                d.setAttribute('data-palo', t.carta.palo);
                d.innerHTML = `${t.carta.valor}<br>${ICONOS[t.carta.palo]}`;
                a.appendChild(d);
            });
        }
    </script>
</body>
</html>
