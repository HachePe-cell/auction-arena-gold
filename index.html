<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Cards | BOT Fix</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #d4af37; --felt: #0a5c36; --oro: #b8860b; --copa: #d32f2f; --espada: #1976d2; --basto: #388e3c; }
        body, html { margin: 0; padding: 0; height: 100%; background: #121212; color: white; font-family: sans-serif; overflow: hidden; }
        .screen { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        .card-menu { background: rgba(255,255,255,0.05); padding: 25px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; width: 85%; max-width: 350px; }
        .btn-main { background: var(--gold); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; margin-bottom: 8px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #eee; color: #000; }

        #screen-game { background: radial-gradient(circle, var(--felt) 0%, #052c1a 100%); }
        .scoreboard { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 1px solid var(--gold); font-size: 0.8rem; z-index: 100; }
        
        .hand { display: flex; gap: 8px; position: absolute; bottom: 25px; z-index: 10; }
        .card { 
            width: 70px; height: 105px; background: white; border-radius: 8px; color: black;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; border: 3px solid #333; cursor: pointer;
        }
        .card[data-palo="Oros"] { color: var(--oro); border-color: var(--oro); }
        .card[data-palo="Copas"] { color: var(--copa); border-color: var(--copa); }
        .card[data-palo="Espadas"] { color: var(--espada); border-color: var(--espada); }
        .card[data-palo="Bastos"] { color: var(--basto); border-color: var(--basto); }

        #played-area { width: 100%; height: 140px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .msg { position: absolute; top: 85px; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: var(--gold); }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active">
        <div class="card-menu">
            <h1 style="color:var(--gold); margin:0;">ELITE CARDS</h1>
            <input type="text" id="player-nick" placeholder="Tu Apodo">
            <p>Dificultad:</p>
            <select id="bot-difficulty">
                <option value="easy">F치cil 游릭</option>
                <option value="hard">Dif칤cil 游댮</option>
            </select>
            <button class="btn-main" onclick="iniciarModoBot()">JUGAR CONTRA BOT</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="scoreboard">
            T칔: <span id="score-mine">0</span> | BOT: <span id="score-theirs">0</span>
        </div>
        <div id="turn-indicator" class="msg">Tu turno</div>
        <div id="played-area"></div>
        <div class="hand" id="my-hand"></div>
    </div>

    <script>
        // Configuraci칩n m칤nima necesaria
        let miNombre = "", miMano = [], manoBot = [], mesaLocal = null;
        const ICONOS = { "Oros": "游뿣", "Copas": "游끥", "Espadas": "丘덢잺", "Bastos": "游뿻" };

        function obtenerPoder(v, p) {
            if (v === 1 && p === "Espadas") return 14;
            if (v === 1 && p === "Bastos") return 13;
            if (v === 7 && p === "Espadas") return 12;
            if (v === 7 && p === "Oros") return 11;
            if (v === 3) return 10; if (v === 2) return 9; if (v === 1) return 8;
            return v;
        }

        function generarMazo() {
            const m = [];
            ["Oros", "Copas", "Espadas", "Bastos"].forEach(p => [1,2,3,4,5,6,7,10,11,12].forEach(v => m.push({valor:v, palo:p})));
            return m.sort(() => Math.random() - 0.5);
        }

        function iniciarModoBot() {
            miNombre = document.getElementById('player-nick').value || "Jugador";
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('screen-game').style.display = 'flex';
            
            const mazo = generarMazo();
            miMano = [mazo[0], mazo[2], mazo[4]];
            manoBot = [mazo[1], mazo[3], mazo[5]];
            
            mesaLocal = {
                turno: miNombre,
                puntosHost: 0,
                puntosInvitado: 0,
                cartasTiradas: []
            };
            actualizarInterfaz();
        }

        function tirarCartaJugador(index) {
            if (mesaLocal.turno !== miNombre || mesaLocal.cartasTiradas.length >= 2) return;

            const carta = miMano.splice(index, 1)[0];
            mesaLocal.cartasTiradas.push({ jugador: miNombre, carta: carta });
            mesaLocal.turno = "Bot";
            
            actualizarInterfaz();
            
            // Si el jugador tir칩 primero, el BOT responde
            if (mesaLocal.cartasTiradas.length === 1) {
                setTimeout(decisionBot, 1000);
            } else {
                verificarGanadorRonda();
            }
        }

        function decisionBot() {
            const dif = document.getElementById('bot-difficulty').value;
            let index = 0;

            if (dif === "hard") {
                // Inteligencia: busca la carta que apenas supere a la del jugador o la m치s baja
                const cartaJugador = mesaLocal.cartasTiradas[0].carta;
                const poderJugador = obtenerPoder(cartaJugador.valor, cartaJugador.palo);
                // Intenta ganar con la m칤nima carta posible
                manoBot.sort((a,b) => obtenerPoder(a.valor, a.palo) - obtenerPoder(b.valor, b.palo));
                index = manoBot.findIndex(c => obtenerPoder(c.valor, c.palo) > poderJugador);
                if (index === -1) index = 0; // Si no puede ganar, tira la m치s baja
            } else {
                index = Math.floor(Math.random() * manoBot.length);
            }

            const carta = manoBot.splice(index, 1)[0];
            mesaLocal.cartasTiradas.push({ jugador: "Bot", carta: carta });
            
            actualizarInterfaz();
            verificarGanadorRonda();
        }

        function verificarGanadorRonda() {
            if (mesaLocal.cartasTiradas.length === 2) {
                setTimeout(() => {
                    const p1 = obtenerPoder(mesaLocal.cartasTiradas[0].carta.valor, mesaLocal.cartasTiradas[0].carta.palo);
                    const p2 = obtenerPoder(mesaLocal.cartasTiradas[1].carta.valor, mesaLocal.cartasTiradas[1].carta.palo);
                    
                    // Quien tir칩 la carta con m치s poder gana (o el primero si empatan)
                    const ganador = (p1 >= p2) ? mesaLocal.cartasTiradas[0].jugador : mesaLocal.cartasTiradas[1].jugador;
                    
                    if (ganador === miNombre) mesaLocal.puntosHost++;
                    else mesaLocal.puntosInvitado++;

                    mesaLocal.cartasTiradas = [];
                    mesaLocal.turno = ganador;

                    // Si se acaban las cartas, repartir de nuevo
                    if (miMano.length === 0) {
                        const mazo = generarMazo();
                        miMano = [mazo[0], mazo[2], mazo[4]];
                        manoBot = [mazo[1], mazo[3], mazo[5]];
                    }

                    // Verificar fin de juego
                    if (mesaLocal.puntosHost >= 15 || mesaLocal.puntosInvitado >= 15) {
                        alert("JUEGO TERMINADO. Ganador: " + (mesaLocal.puntosHost >= 15 ? miNombre : "Bot"));
                        location.reload();
                    }

                    actualizarInterfaz();

                    // Si gan칩 el BOT, 칠l empieza la siguiente ronda
                    if (mesaLocal.turno === "Bot") {
                        setTimeout(decisionBot, 1000);
                    }
                }, 1500);
            }
        }

        function actualizarInterfaz() {
            document.getElementById('score-mine').innerText = mesaLocal.puntosHost;
            document.getElementById('score-theirs').innerText = mesaLocal.puntosInvitado;
            document.getElementById('turn-indicator').innerText = mesaLocal.turno === miNombre ? "TU TURNO" : "Bot pensando...";

            const handDiv = document.getElementById('my-hand');
            handDiv.innerHTML = "";
            miMano.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = 'card';
                div.setAttribute('data-palo', c.palo);
                div.innerHTML = `<div>${c.valor}</div><div>${ICONOS[c.palo]}</div>`;
                div.onclick = () => tirarCartaJugador(i);
                handDiv.appendChild(div);
            });

            const tableDiv = document.getElementById('played-area');
            tableDiv.innerHTML = "";
            mesaLocal.cartasTiradas.forEach(t => {
                const div = document.createElement('div');
                div.className = 'card';
                div.setAttribute('data-palo', t.carta.palo);
                div.style.cursor = "default";
                div.innerHTML = `<div>${t.carta.valor}</div><div>${ICONOS[t.carta.palo]}</div>`;
                tableDiv.appendChild(div);
            });
        }
    </script>
</body>
</html>
